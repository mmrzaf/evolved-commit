repair:
  max_attempts: 2
  max_actions_per_attempt: 2
  capabilities:
    - id: go_mod_tidy
      description: Sync go.mod and go.sum after dependency or import changes
      argv: ["go", "mod", "tidy"]
      timeout_seconds: 120
      max_runs_per_attempt: 1
      allowed_failure_kinds:
        - dependency_manifest_missing
        - dependency_fetch

    - id: go_test_mod_readonly
      description: Verify module graph is clean and no implicit dependency edits are needed
      argv: ["go", "test", "-mod=readonly", "./..."]
      timeout_seconds: 180
      max_runs_per_attempt: 1
      allowed_failure_kinds:
        - dependency_manifest_missing
        - compile_failure
        - test_failure
        - unknown_failure

    - id: go_generate
      description: Regenerate code/assets for repos that rely on go generate
      argv: ["go", "generate", "./..."]
      timeout_seconds: 180
      max_runs_per_attempt: 1
      allowed_failure_kinds:
        - compile_failure
        - test_failure
